#!/usr/bin/env bash
BUCKET_FILE="/var/run/secrets/drycc/minio/creds/builderBucket"
ACCESS_KEY_FILE="/var/run/secrets/drycc/minio/creds/accesskey"
SECRET_KEY_FILE="/var/run/secrets/drycc/minio/creds/secretkey"

if [ -f $BUCKET_FILE ]; then
  MINIO_BUCKET=$(cat "$BUCKET_FILE")
  export MINIO_BUCKET
fi
if [ -f $ACCESS_KEY_FILE ]; then
  MINIO_ACCESS_KEY=$(cat "$ACCESS_KEY_FILE")
  export MINIO_ACCESS_KEY
fi
if [ -f $SECRET_KEY_FILE ]; then
  MINIO_SECRET_KEY=$(cat "$SECRET_KEY_FILE")
  export MINIO_SECRET_KEY
fi

export MINIO_ENDPOINT="${DRYCC_MINIO_ENDPOINT}"

# force aws signv4 to avoid probe
mc config host add minio "${MINIO_ENDPOINT}" "${MINIO_ACCESS_KEY}" "${MINIO_SECRET_KEY}" --api s3v4
